<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel="Stylesheet" type="text/css" href="qunit.css" />
	<title>Unit Test</title>
</head>
<body>

<h1 id="qunit-header">Unit Test</h1>
<h2 id="qunit-banner"></h2>
<ol id="qunit-tests"></ol>

<script src="jquery-1.6.2.min.js"></script>
<script src="qunit.js"></script>
<script src="../rjs.js"></script>
<script src="../rjs-proto.js"></script>

<script>
$(function() {

	module("rjs");

	test("each", function() {
		var arr = [1,2,3,4,5];
		var copyOut = [];
		RJS.each(arr, function(x) {
			copyOut.push(x * 2);
		});
		deepEqual(copyOut, [2,4,6,8,10], "Iterate through each item in a list);
		deepEqual(arr, [1,2,3,4,5], "Original array intact.");
	});

	test("filter", function() {
		var arr = [1,2,3,4,5];
		var even = function(n) { return n%2===0; };
		deepEqual(RJS.filter(arr, even), [2,4], "Filters out falsey results.");
		deepEqual(arr, [1,2,3,4,5], "Original array intact.");
	});

	test("filterBy", function() {
		var arr = [{a: 1, b: 2}, {a: 1, b: 5}, {a: 0, b: 10}];
		deepEqual(RJS.filterBy(arr, "a", 1), [{a: 1, b: 2}, {a: 1, b: 5}], "Filter an array of objects by a given property value.");
	});

	test("changeKeys", function() {
		// Assertions, ok, equal, notEqual, deepEqual, notDeepEqual, strictEqual, notStrictEqual
		var oldObject = { fname: "Raine", lname: "Lourie", specialty: "Javascript" };
		var newObject = RJS.changeKeys( oldObject, { fname: "first", lname: "last" });
		deepEqual(oldObject, { fname: "Raine", lname: "Lourie", specialty: "Javascript" }, "Old object is unmodified.");
		deepEqual(newObject, { first: "Raine", last: "Lourie", specialty: "Javascript" }, "New object contains modified keys.");

	});

	test("new", function() {
		var Person = function(name, age) {
			this.name = name;
			this.age = age;
		};
		var p = RJS.new(Person, "Raine", 26);
		ok(p instanceof Person);
		equal(p.name, "Raine");
		equal(p.age, 26);
	});

	test("pluck", function() {
		var arr = [{a: 1, b: 2}, {a: 1, b: 5}, {a: 0, b: 10}];
		deepEqual(RJS.pluck(arr, "a"), [1, 1, 0]);
		deepEqual(RJS.pluck(arr, "b"), [2, 5, 10]);
	});

	asyncTest("callAfterDone", 4, function() {
		var queue1 = [
			function(cb) { cb(1); }, 
			function(cb) { cb(2); }
		];
		RJS.callAfterDone(queue1, function(results) {
			ok(true, "Final callback called");
			deepEqual(results, [1,2], "When the function queue is an array, results are passed to the final callback in original order");
			start();
		});

		var queue2 = {
			a: function(cb) { cb(1); }, 
			b: function(cb) { cb(2); }
		};
		RJS.callAfterDone(queue2, function(results) {
			deepEqual(results, { a: 1, b: 2 }, "When the function queue is an object, results are passed to the final callback with original keys");
			start();
		});

		var queue3 = {
			a: [
				function(cb) { cb("a.a1"); },
				function(cb) { cb("a.a2"); },
			], 
			b: {
				b1: function(cb) { cb("b.b1"); },
				b2: {
					c: {
						d: function(cb) { cb("b.b2.c.d"); }
					}
				}
			}
		};

		RJS.callAfterDone(queue3, function(results) {
			var recursiveResult = {
				a: [
					"a.a1",
					"a.a2",
				], 
				b: {
					b1: "b.b1",
					b2: {
						c: {
							d: "b.b2.c.d"
						}
					}
				}
			};
			deepEqual(results, recursiveResult, "When the function queue is an object, results are passed to the final callback with original keys");
			start();
		});
	});

	test("curry", function() {
		var subtract = function(x,y) { return x - y; };
		var subtractFromTen = RJS.curry(subtract, [10]);
		equal(subtractFromTen(1), 9);
	});

	test("currify", function() {
		var subtract = function(x,y) { return x - y; };
		var curriedSubtract = RJS.currify(subtract);
		equal(curriedSubtract(10,1), 9, "If all arguments are specified, return the result.");
		equal(curriedSubtract(1,10), -9, "Argument order is preserved (left curry)");

		var addThree = function(x,y,z) { return x + y + z; };
		var curriedAddThree = RJS.currify(addThree);
		equal(curriedAddThree(1,2,4), 7, "If arguments are partially specified, return a new currified function.");
		equal(curriedAddThree(1,2)(4), 7, "If arguments are partially specified, return a new currified function.");
		equal(curriedAddThree(1)(2,4), 7, "If arguments are partially specified, return a new currified function.");
		equal(curriedAddThree(1)(2)(4), 7, "If arguments are partially specified, return a new currified function.");
	});

	/******************************************************
	 * PROTOTYPED
	 ******************************************************/
	module("rjs-proto");

	test("each", function() {
		var arr = [1,2,3,4,5];
		var copyOut = [];
		arr.each(function(x) {
			copyOut.push(x * 2);
		});
		deepEqual(copyOut, [2,4,6,8,10], "Iterate through each item in a list);
		deepEqual(arr, [1,2,3,4,5], "Original array intact.");
	});

	test("new", function() {
		var Person = function(name, age) {
			this.name = name;
			this.age = age;
		};
		var p = Person.new("Raine", 26);
		ok(p instanceof Person);
		equal(p.name, "Raine");
		equal(p.age, 26);
	});
});
</script>

</body>
</html>
